@inherits LayoutComponentBase
@inject AuthenticationStateProvider AuthProvider
@inject NavigationManager Nav

<CascadingAuthenticationState>
    @if (!_checkedAuth)
    {
        <p>Lade...</p>
    }
    else if (_isAuthenticated)
    {
        @Body
        <BistroRater.Components.Elements.LogoutButton/>
    }
    else
    {
        <BistroRater.Components.Pages.LoginScreen/>
    }

    <div id="blazor-error-ui" data-nosnippet>
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">🗙</span>
    </div>
</CascadingAuthenticationState>

@code {
    private bool _checkedAuth = false;
    private bool _isAuthenticated = false;

    protected override async Task OnInitializedAsync()
    {
        var state = await AuthProvider.GetAuthenticationStateAsync();
        _isAuthenticated = state.User?.Identity?.IsAuthenticated ?? false;

        _checkedAuth = true;
    }

}